{
  "__document_status__": "Active",
  "name": "Loopar Api Reference",
  "module": "loopar-webpage",
  "doc_structure": "[{\"element\":\"menu_content\",\"data\":{\"label\":\"API Reference\",\"key\":\"api_menu_content\",\"id\":\"api_menu_content\",\"name\":\"api_menu_content\"},\"elements\":[{\"element\":\"markdown\",\"data\":{\"label\":\"Overview\",\"key\":\"md_api_overview\",\"id\":\"api-overview\",\"name\":\"md_api_overview\",\"value\":\"# API Reference\\n\\nComplete reference for Loopar's server-side APIs.\\n\\n---\\n\\n## Core Objects\\n\\n| Object | Description |\\n|--------|-------------|\\n| `loopar` | Global framework object |\\n| `BaseDocument` | Base class for Models |\\n| `BaseController` | Base class for Controllers |\\n\\n---\\n\\n## Import Patterns\\n\\n```javascript\\n// In Model (.js)\\nimport { BaseDocument } from \\\"loopar\\\";\\nimport loopar from \\\"loopar\\\";\\n\\n// In Controller (-controller.js)\\nimport { BaseController } from \\\"loopar\\\";\\nimport loopar from \\\"loopar\\\";\\n\\n// In any server file\\nimport loopar from \\\"loopar\\\";\\n```\\n\\n---\\n\\n## Quick Reference\\n\\n### Document Operations\\n```javascript\\nconst doc = await loopar.getDocument(\\\"Entity\\\", \\\"name\\\");\\nconst doc = await loopar.newDocument(\\\"Entity\\\");\\nawait doc.save();\\nawait doc.delete();\\n```\\n\\n### Database Queries\\n```javascript\\nconst all = await loopar.db.getAll(\\\"Entity\\\", options);\\nconst count = await loopar.db.count(\\\"Entity\\\", filters);\\nconst value = await loopar.db.getValue(\\\"Entity\\\", \\\"name\\\", \\\"field\\\");\\n```\\n\\n### Utilities\\n```javascript\\nconst user = loopar.session.user;\\nconst config = loopar.config.get(\\\"key\\\");\\nawait loopar.sendEmail({ to, subject, body });\\n```\"}},{\"element\":\"markdown\",\"data\":{\"label\":\"loopar\",\"key\":\"md_api_loopar\",\"id\":\"api-loopar\",\"name\":\"md_api_loopar\",\"value\":\"# loopar (Global Object)\\n\\nThe main framework object available throughout the server-side code.\\n\\n```javascript\\nimport loopar from \\\"loopar\\\";\\n```\\n\\n---\\n\\n## Document Methods\\n\\n### loopar.getDocument(entity, name)\\n\\nRetrieve an existing document by name.\\n\\n```javascript\\nconst customer = await loopar.getDocument(\\\"Customer\\\", \\\"CUST-0001\\\");\\n\\n// Access fields\\nconsole.log(customer.email);\\nconsole.log(customer.status);\\n\\n// Call model methods\\nconst fullName = customer.getFullName();\\n```\\n\\n| Parameter | Type | Description |\\n|-----------|------|-------------|\\n| `entity` | string | Entity name |\\n| `name` | string | Document name/ID |\\n\\n**Returns:** Document instance\\n\\n**Throws:** Error if document not found\\n\\n---\\n\\n### loopar.newDocument(entity, data?)\\n\\nCreate a new document instance.\\n\\n```javascript\\n// Create empty\\nconst customer = await loopar.newDocument(\\\"Customer\\\");\\ncustomer.customer_name = \\\"John Doe\\\";\\ncustomer.email = \\\"john@example.com\\\";\\nawait customer.save();\\n\\n// Create with initial data\\nconst task = await loopar.newDocument(\\\"Task\\\", {\\n  title: \\\"New Task\\\",\\n  status: \\\"Open\\\",\\n  priority: \\\"High\\\"\\n});\\nawait task.save();\\n```\\n\\n| Parameter | Type | Description |\\n|-----------|------|-------------|\\n| `entity` | string | Entity name |\\n| `data` | object | Initial field values (optional) |\\n\\n**Returns:** New document instance (unsaved)\\n\\n---\\n\\n### loopar.deleteDocument(entity, name)\\n\\nDelete a document by name.\\n\\n```javascript\\nawait loopar.deleteDocument(\\\"Customer\\\", \\\"CUST-0001\\\");\\n```\\n\\n| Parameter | Type | Description |\\n|-----------|------|-------------|\\n| `entity` | string | Entity name |\\n| `name` | string | Document name/ID |\\n\\n---\\n\\n## Session & User\\n\\n### loopar.session\\n\\nCurrent session information.\\n\\n```javascript\\n// Current user\\nconst user = loopar.session.user;\\nconst userName = loopar.session.user_name;\\n\\n// Check if logged in\\nif (loopar.session.user) {\\n  // User is authenticated\\n}\\n\\n// Current site/tenant\\nconst site = loopar.session.site;\\n```\\n\\n| Property | Type | Description |\\n|----------|------|-------------|\\n| `user` | string | Current user ID |\\n| `user_name` | string | User display name |\\n| `site` | string | Current tenant name |\\n| `is_admin` | boolean | Is administrator |\\n\\n---\\n\\n## Configuration\\n\\n### loopar.config\\n\\nAccess framework configuration.\\n\\n```javascript\\n// Get config value\\nconst dbType = loopar.config.get(\\\"db_type\\\");\\nconst port = loopar.config.get(\\\"port\\\");\\n\\n// Get with default\\nconst timeout = loopar.config.get(\\\"timeout\\\", 5000);\\n```\\n\\n---\\n\\n## Utilities\\n\\n### loopar.sendEmail(options)\\n\\nSend an email.\\n\\n```javascript\\nawait loopar.sendEmail({\\n  to: \\\"customer@example.com\\\",\\n  subject: \\\"Welcome!\\\",\\n  body: \\\"<h1>Welcome to our platform</h1>\\\",\\n  // Optional\\n  from: \\\"noreply@yoursite.com\\\",\\n  cc: [\\\"manager@yoursite.com\\\"],\\n  attachments: [{ filename: \\\"doc.pdf\\\", path: \\\"/path/to/doc.pdf\\\" }]\\n});\\n```\\n\\n| Option | Type | Description |\\n|--------|------|-------------|\\n| `to` | string/array | Recipient(s) |\\n| `subject` | string | Email subject |\\n| `body` | string | HTML body |\\n| `from` | string | Sender (optional) |\\n| `cc` | array | CC recipients |\\n| `bcc` | array | BCC recipients |\\n| `attachments` | array | File attachments |\\n\\n---\\n\\n### loopar.throw(message, httpCode?)\\n\\nThrow an error with optional HTTP status code.\\n\\n```javascript\\nif (!customer) {\\n  loopar.throw(\\\"Customer not found\\\", 404);\\n}\\n\\nif (!hasPermission) {\\n  loopar.throw(\\\"Access denied\\\", 403);\\n}\\n```\\n\\n---\\n\\n### loopar.log(message, level?)\\n\\nLog a message.\\n\\n```javascript\\nloopar.log(\\\"Processing started\\\");\\nloopar.log(\\\"Warning: slow query\\\", \\\"warn\\\");\\nloopar.log(\\\"Error occurred\\\", \\\"error\\\");\\n```\\n\\n| Level | Description |\\n|-------|-------------|\\n| `info` | Information (default) |\\n| `warn` | Warning |\\n| `error` | Error |\\n| `debug` | Debug (dev only) |\"}},{\"element\":\"markdown\",\"data\":{\"label\":\"loopar.db\",\"key\":\"md_api_db\",\"id\":\"api-db\",\"name\":\"md_api_db\",\"value\":\"# loopar.db (Database API)\\n\\nDirect database operations for querying and manipulating data.\\n\\n```javascript\\nimport loopar from \\\"loopar\\\";\\n\\nconst results = await loopar.db.getAll(\\\"Customer\\\");\\n```\\n\\n---\\n\\n## Query Methods\\n\\n### loopar.db.getAll(entity, options?)\\n\\nGet multiple documents with filtering, sorting, and pagination.\\n\\n```javascript\\n// Simple: get all\\nconst customers = await loopar.db.getAll(\\\"Customer\\\");\\n\\n// With filters\\nconst activeCustomers = await loopar.db.getAll(\\\"Customer\\\", {\\n  filters: { status: \\\"Active\\\" }\\n});\\n\\n// Complex query\\nconst results = await loopar.db.getAll(\\\"Task\\\", {\\n  filters: {\\n    status: [\\\"Open\\\", \\\"In Progress\\\"],  // OR condition\\n    priority: \\\"High\\\",\\n    project: \\\"PROJECT-001\\\"\\n  },\\n  fields: [\\\"name\\\", \\\"title\\\", \\\"status\\\", \\\"due_date\\\"],\\n  orderBy: \\\"due_date ASC\\\",\\n  limit: 20,\\n  offset: 0\\n});\\n```\\n\\n| Option | Type | Description |\\n|--------|------|-------------|\\n| `filters` | object | Field conditions |\\n| `fields` | array | Fields to return |\\n| `orderBy` | string | Sort order (`field ASC/DESC`) |\\n| `limit` | number | Max records to return |\\n| `offset` | number | Records to skip |\\n\\n**Filter Operators:**\\n```javascript\\n// Exact match\\n{ status: \\\"Active\\\" }\\n\\n// OR condition (array)\\n{ status: [\\\"Open\\\", \\\"In Progress\\\"] }\\n\\n// Multiple conditions (AND)\\n{ status: \\\"Active\\\", priority: \\\"High\\\" }\\n\\n// With operators\\n{ amount: [\\\">\\\", 1000] }\\n{ created_at: [\\\">=\\\", \\\"2024-01-01\\\"] }\\n{ name: [\\\"like\\\", \\\"%john%\\\"] }\\n```\\n\\n---\\n\\n### loopar.db.getOne(entity, filters)\\n\\nGet a single document matching filters.\\n\\n```javascript\\nconst customer = await loopar.db.getOne(\\\"Customer\\\", {\\n  email: \\\"john@example.com\\\"\\n});\\n\\nif (customer) {\\n  console.log(customer.name);\\n}\\n```\\n\\n**Returns:** Single document object or `null`\\n\\n---\\n\\n### loopar.db.getValue(entity, name, field)\\n\\nGet a single field value from a document.\\n\\n```javascript\\nconst email = await loopar.db.getValue(\\\"Customer\\\", \\\"CUST-0001\\\", \\\"email\\\");\\nconst status = await loopar.db.getValue(\\\"Task\\\", \\\"TASK-0001\\\", \\\"status\\\");\\n```\\n\\n| Parameter | Type | Description |\\n|-----------|------|-------------|\\n| `entity` | string | Entity name |\\n| `name` | string | Document name |\\n| `field` | string | Field to retrieve |\\n\\n**Returns:** Field value or `null`\\n\\n---\\n\\n### loopar.db.count(entity, filters?)\\n\\nCount documents matching filters.\\n\\n```javascript\\n// Count all\\nconst totalCustomers = await loopar.db.count(\\\"Customer\\\");\\n\\n// Count with filter\\nconst activeCount = await loopar.db.count(\\\"Customer\\\", {\\n  status: \\\"Active\\\"\\n});\\n\\n// Count with multiple conditions\\nconst urgentOpen = await loopar.db.count(\\\"Task\\\", {\\n  status: \\\"Open\\\",\\n  priority: \\\"Urgent\\\"\\n});\\n```\\n\\n**Returns:** Number\\n\\n---\\n\\n### loopar.db.exists(entity, name)\\n\\nCheck if a document exists.\\n\\n```javascript\\nconst exists = await loopar.db.exists(\\\"Customer\\\", \\\"CUST-0001\\\");\\n\\nif (!exists) {\\n  // Create new customer\\n}\\n```\\n\\n**Returns:** Boolean\\n\\n---\\n\\n## Modify Methods\\n\\n### loopar.db.setValue(entity, name, field, value)\\n\\nUpdate a single field value.\\n\\n```javascript\\nawait loopar.db.setValue(\\\"Customer\\\", \\\"CUST-0001\\\", \\\"status\\\", \\\"VIP\\\");\\nawait loopar.db.setValue(\\\"Task\\\", \\\"TASK-0001\\\", \\\"completed_at\\\", new Date());\\n```\\n\\n> **Note:** This bypasses model hooks. Use `doc.save()` for full lifecycle.\\n\\n---\\n\\n### loopar.db.setValues(entity, name, values)\\n\\nUpdate multiple field values.\\n\\n```javascript\\nawait loopar.db.setValues(\\\"Customer\\\", \\\"CUST-0001\\\", {\\n  status: \\\"VIP\\\",\\n  credit_limit: 50000,\\n  modified_at: new Date()\\n});\\n```\\n\\n---\\n\\n## Raw SQL\\n\\n### loopar.db.execute(sql, params?)\\n\\nExecute raw SQL query.\\n\\n```javascript\\n// Simple query\\nconst results = await loopar.db.execute(\\n  \\\"SELECT * FROM Customer WHERE status = ?\\\",\\n  [\\\"Active\\\"]\\n);\\n\\n// Complex aggregation\\nconst stats = await loopar.db.execute(`\\n  SELECT \\n    project,\\n    COUNT(*) as task_count,\\n    SUM(CASE WHEN status = 'Completed' THEN 1 ELSE 0 END) as completed\\n  FROM Task\\n  WHERE created_at > ?\\n  GROUP BY project\\n`, [\\\"2024-01-01\\\"]);\\n```\\n\\n> **Warning:** Use parameterized queries to prevent SQL injection.\\n\\n---\\n\\n## Transactions\\n\\n### loopar.db.transaction(callback)\\n\\nExecute operations in a transaction.\\n\\n```javascript\\nawait loopar.db.transaction(async (trx) => {\\n  // All operations use same transaction\\n  const order = await loopar.newDocument(\\\"Order\\\");\\n  order.customer = \\\"CUST-0001\\\";\\n  order.total = 1500;\\n  await order.save({ trx });\\n\\n  // Update customer balance\\n  const customer = await loopar.getDocument(\\\"Customer\\\", \\\"CUST-0001\\\");\\n  customer.balance += 1500;\\n  await customer.save({ trx });\\n\\n  // If any operation fails, all are rolled back\\n});\\n```\"}},{\"element\":\"markdown\",\"data\":{\"label\":\"BaseDocument\",\"key\":\"md_api_basedocument\",\"id\":\"api-basedocument\",\"name\":\"md_api_basedocument\",\"value\":\"# BaseDocument\\n\\nBase class for all Models. Extend this to add custom logic to your entities.\\n\\n```javascript\\n// customer.js (MODEL)\\nimport { BaseDocument } from \\\"loopar\\\";\\n\\nexport default class Customer extends BaseDocument {\\n  constructor(props) {\\n    super(props);\\n  }\\n}\\n```\\n\\n---\\n\\n## Instance Properties\\n\\n### Field Values\\n\\nAccess and set field values directly.\\n\\n```javascript\\n// Read fields\\nconst name = this.customer_name;\\nconst email = this.email;\\nconst status = this.status;\\n\\n// Set fields\\nthis.status = \\\"Active\\\";\\nthis.modified_at = new Date();\\nthis.total = this.subtotal + this.tax;\\n```\\n\\n---\\n\\n### this.name\\n\\nThe document's unique identifier.\\n\\n```javascript\\nconsole.log(this.name); // \\\"CUST-0001\\\"\\n```\\n\\n---\\n\\n### this.isNew\\n\\nWhether this is a new (unsaved) document.\\n\\n```javascript\\nasync beforeSave() {\\n  if (this.isNew) {\\n    this.created_at = new Date();\\n    this.created_by = this.session.user;\\n  }\\n}\\n```\\n\\n---\\n\\n### this.session\\n\\nCurrent session information.\\n\\n```javascript\\nconst currentUser = this.session.user;\\nconst currentSite = this.session.site;\\n```\\n\\n---\\n\\n### this.request\\n\\nHTTP request object (when triggered via API).\\n\\n```javascript\\nconst body = this.request?.body;\\nconst query = this.request?.query;\\nconst headers = this.request?.headers;\\n```\\n\\n---\\n\\n## Instance Methods\\n\\n### this.save(options?)\\n\\nSave the document to database.\\n\\n```javascript\\n// Simple save\\nawait this.save();\\n\\n// Save with options\\nawait this.save({\\n  ignore_permissions: true,  // Skip permission check\\n  ignore_validate: false,    // Skip validation\\n  trx: transaction           // Use transaction\\n});\\n```\\n\\n**Triggers:** `validate()` → `beforeSave()` → `beforeInsert()/beforeUpdate()` → DB → `afterInsert()/afterUpdate()` → `afterSave()`\\n\\n---\\n\\n### this.delete()\\n\\nDelete the document.\\n\\n```javascript\\nawait this.delete();\\n```\\n\\n**Triggers:** `beforeDelete()` → DB → `afterDelete()`\\n\\n---\\n\\n### this.reload()\\n\\nReload document from database.\\n\\n```javascript\\nawait this.reload();\\n```\\n\\n---\\n\\n### this.getData()\\n\\nGet document as plain object.\\n\\n```javascript\\nconst data = this.getData();\\n// { name: \\\"CUST-0001\\\", customer_name: \\\"John\\\", email: \\\"john@...\\\", ... }\\n```\\n\\n---\\n\\n## Lifecycle Hooks\\n\\nOverride these methods to add custom logic.\\n\\n### async validate()\\n\\nValidate before any save operation.\\n\\n```javascript\\nasync validate() {\\n  if (!this.email) {\\n    throw new Error(\\\"Email is required\\\");\\n  }\\n  \\n  if (this.amount < 0) {\\n    throw new Error(\\\"Amount cannot be negative\\\");\\n  }\\n\\n  // Check for duplicates\\n  const existing = await loopar.db.getOne(\\\"Customer\\\", {\\n    email: this.email,\\n    name: [\\\"!=\\\", this.name]  // Exclude self\\n  });\\n  \\n  if (existing) {\\n    throw new Error(\\\"Email already exists\\\");\\n  }\\n}\\n```\\n\\n---\\n\\n### async beforeInsert()\\n\\nBefore saving a NEW document.\\n\\n```javascript\\nasync beforeInsert() {\\n  this.created_at = new Date();\\n  this.created_by = this.session.user;\\n  this.status = this.status || \\\"Draft\\\";\\n  \\n  // Generate custom ID\\n  this.customer_id = await this.generateCustomerId();\\n}\\n```\\n\\n---\\n\\n### async afterInsert()\\n\\nAfter saving a NEW document.\\n\\n```javascript\\nasync afterInsert() {\\n  // Send welcome email\\n  await loopar.sendEmail({\\n    to: this.email,\\n    subject: \\\"Welcome!\\\",\\n    body: `Hello ${this.customer_name}!`\\n  });\\n  \\n  // Create related records\\n  const settings = await loopar.newDocument(\\\"Customer Settings\\\");\\n  settings.customer = this.name;\\n  await settings.save();\\n}\\n```\\n\\n---\\n\\n### async beforeUpdate()\\n\\nBefore updating an EXISTING document.\\n\\n```javascript\\nasync beforeUpdate() {\\n  this.modified_at = new Date();\\n  this.modified_by = this.session.user;\\n}\\n```\\n\\n---\\n\\n### async afterUpdate()\\n\\nAfter updating an EXISTING document.\\n\\n```javascript\\nasync afterUpdate() {\\n  // Log changes\\n  await this.logChanges();\\n  \\n  // Notify if status changed\\n  if (this.status !== this._previousStatus) {\\n    await this.notifyStatusChange();\\n  }\\n}\\n```\\n\\n---\\n\\n### async beforeSave()\\n\\nBefore any save (insert OR update).\\n\\n```javascript\\nasync beforeSave() {\\n  // Calculate totals\\n  this.total = this.subtotal + this.tax - this.discount;\\n  \\n  // Update full name\\n  this.full_name = `${this.first_name} ${this.last_name}`;\\n}\\n```\\n\\n---\\n\\n### async afterSave()\\n\\nAfter any save (insert OR update).\\n\\n```javascript\\nasync afterSave() {\\n  // Update related records\\n  await this.updateRelatedRecords();\\n  \\n  // Clear cache\\n  await this.clearCache();\\n}\\n```\\n\\n---\\n\\n### async beforeDelete()\\n\\nBefore deleting.\\n\\n```javascript\\nasync beforeDelete() {\\n  // Prevent deletion of locked records\\n  if (this.is_locked) {\\n    throw new Error(\\\"Cannot delete locked record\\\");\\n  }\\n  \\n  // Check for dependencies\\n  const orders = await loopar.db.count(\\\"Order\\\", { customer: this.name });\\n  if (orders > 0) {\\n    throw new Error(\\\"Cannot delete customer with orders\\\");\\n  }\\n}\\n```\\n\\n---\\n\\n### async afterDelete()\\n\\nAfter deleting.\\n\\n```javascript\\nasync afterDelete() {\\n  // Clean up related data\\n  await loopar.db.execute(\\n    \\\"DELETE FROM CustomerSettings WHERE customer = ?\\\",\\n    [this.name]\\n  );\\n  \\n  // Log deletion\\n  console.log(`Customer ${this.name} deleted`);\\n}\\n```\"}},{\"element\":\"markdown\",\"data\":{\"label\":\"BaseController\",\"key\":\"md_api_basecontroller\",\"id\":\"api-basecontroller\",\"name\":\"md_api_basecontroller\",\"value\":\"# BaseController\\n\\nBase class for Controllers. Only methods prefixed with `action` are accessible via URL.\\n\\n```javascript\\n// customer-controller.js (CONTROLLER)\\nimport { BaseController } from \\\"loopar\\\";\\n\\nexport default class CustomerController extends BaseController {\\n  \\n  // GET/POST /api/Customer/stats\\n  async actionStats() {\\n    return { total: 100 };\\n  }\\n}\\n```\\n\\n---\\n\\n## URL Routing\\n\\n| Method Name | URL | HTTP Methods |\\n|-------------|-----|-------------|\\n| `actionView` | `/api/Entity/view` | GET, POST |\\n| `actionCreate` | `/api/Entity/create` | POST |\\n| `actionStats` | `/api/Entity/stats` | GET, POST |\\n| `actionSendEmail` | `/api/Entity/send-email` | GET, POST |\\n| `privateMethod` | — | NOT accessible |\\n\\n**Naming:** `actionMyAction` → `/api/Entity/my-action` (camelCase to kebab-case)\\n\\n---\\n\\n## Instance Properties\\n\\n### this.data\\n\\nRequest data (body + query params).\\n\\n```javascript\\nasync actionCreate() {\\n  const { name, email, status } = this.data;\\n  \\n  const customer = await loopar.newDocument(\\\"Customer\\\", {\\n    customer_name: name,\\n    email,\\n    status\\n  });\\n  await customer.save();\\n  \\n  return { success: true, name: customer.name };\\n}\\n```\\n\\n---\\n\\n### this.request\\n\\nFull HTTP request object.\\n\\n```javascript\\nasync actionUpload() {\\n  const file = this.request.files?.document;\\n  const contentType = this.request.headers[\\\"content-type\\\"];\\n  const method = this.request.method;\\n  \\n  // ...\\n}\\n```\\n\\n| Property | Description |\\n|----------|-------------|\\n| `method` | HTTP method (GET, POST, etc.) |\\n| `headers` | Request headers |\\n| `query` | Query string params |\\n| `body` | Request body |\\n| `files` | Uploaded files |\\n| `params` | URL params |\\n\\n---\\n\\n### this.response\\n\\nHTTP response object.\\n\\n```javascript\\nasync actionDownload() {\\n  this.response.setHeader(\\\"Content-Type\\\", \\\"application/pdf\\\");\\n  this.response.setHeader(\\\"Content-Disposition\\\", \\\"attachment; filename=report.pdf\\\");\\n  \\n  // Return file buffer\\n  return fileBuffer;\\n}\\n```\\n\\n---\\n\\n### this.session\\n\\nCurrent session.\\n\\n```javascript\\nasync actionProfile() {\\n  const user = this.session.user;\\n  \\n  if (!user) {\\n    loopar.throw(\\\"Not authenticated\\\", 401);\\n  }\\n  \\n  return await loopar.getDocument(\\\"User\\\", user);\\n}\\n```\\n\\n---\\n\\n## Action Examples\\n\\n### Basic CRUD Action\\n\\n```javascript\\n// POST /api/Customer/create\\nasync actionCreate() {\\n  const customer = await loopar.newDocument(\\\"Customer\\\", this.data);\\n  await customer.save();\\n  \\n  return {\\n    success: true,\\n    message: \\\"Customer created\\\",\\n    name: customer.name\\n  };\\n}\\n```\\n\\n---\\n\\n### Query Action\\n\\n```javascript\\n// GET /api/Customer/search?q=john&status=Active\\nasync actionSearch() {\\n  const { q, status, limit = 20 } = this.data;\\n  \\n  const filters = {};\\n  if (status) filters.status = status;\\n  if (q) filters.customer_name = [\\\"like\\\", `%${q}%`];\\n  \\n  const customers = await loopar.db.getAll(\\\"Customer\\\", {\\n    filters,\\n    limit: parseInt(limit),\\n    orderBy: \\\"customer_name ASC\\\"\\n  });\\n  \\n  return { customers };\\n}\\n```\\n\\n---\\n\\n### Action with Document\\n\\n```javascript\\n// POST /api/Customer/upgrade-to-vip\\nasync actionUpgradeToVip() {\\n  const { name } = this.data;\\n  \\n  if (!name) {\\n    loopar.throw(\\\"Customer name required\\\", 400);\\n  }\\n  \\n  const customer = await loopar.getDocument(\\\"Customer\\\", name);\\n  customer.status = \\\"VIP\\\";\\n  customer.vip_since = new Date();\\n  await customer.save();\\n  \\n  // Call model method\\n  const discount = customer.calculateVIPDiscount();\\n  \\n  return {\\n    success: true,\\n    message: `${customer.customer_name} is now VIP`,\\n    discount\\n  };\\n}\\n```\\n\\n---\\n\\n### Stats/Aggregation Action\\n\\n```javascript\\n// GET /api/Task/dashboard\\nasync actionDashboard() {\\n  const user = this.session.user;\\n  \\n  const [open, inProgress, completed, overdue] = await Promise.all([\\n    loopar.db.count(\\\"Task\\\", { status: \\\"Open\\\", assigned_to: user }),\\n    loopar.db.count(\\\"Task\\\", { status: \\\"In Progress\\\", assigned_to: user }),\\n    loopar.db.count(\\\"Task\\\", { status: \\\"Completed\\\", assigned_to: user }),\\n    loopar.db.execute(\\n      `SELECT COUNT(*) as count FROM Task \\n       WHERE assigned_to = ? AND due_date < NOW() AND status != 'Completed'`,\\n      [user]\\n    ).then(r => r[0]?.count || 0)\\n  ]);\\n  \\n  return {\\n    open,\\n    inProgress,\\n    completed,\\n    overdue,\\n    total: open + inProgress + completed\\n  };\\n}\\n```\\n\\n---\\n\\n### File Download Action\\n\\n```javascript\\n// GET /api/Report/export?format=csv\\nasync actionExport() {\\n  const { format = \\\"csv\\\" } = this.data;\\n  \\n  const data = await loopar.db.getAll(\\\"Customer\\\");\\n  \\n  if (format === \\\"csv\\\") {\\n    const csv = this.convertToCSV(data);\\n    this.response.setHeader(\\\"Content-Type\\\", \\\"text/csv\\\");\\n    this.response.setHeader(\\\"Content-Disposition\\\", \\\"attachment; filename=customers.csv\\\");\\n    return csv;\\n  }\\n  \\n  return { data };\\n}\\n\\n// Private helper (NOT URL accessible)\\nconvertToCSV(data) {\\n  // ...\\n}\\n```\\n\\n---\\n\\n## Error Handling\\n\\n```javascript\\nasync actionRiskyOperation() {\\n  try {\\n    // Risky operation\\n    await this.performOperation();\\n    return { success: true };\\n    \\n  } catch (error) {\\n    // Log error\\n    loopar.log(error.message, \\\"error\\\");\\n    \\n    // Return error response\\n    loopar.throw(error.message, 500);\\n  }\\n}\\n```\\n\\n---\\n\\n## Authentication Check\\n\\n```javascript\\nasync actionSecureAction() {\\n  // Check authentication\\n  if (!this.session.user) {\\n    loopar.throw(\\\"Authentication required\\\", 401);\\n  }\\n  \\n  // Check admin\\n  if (!this.session.is_admin) {\\n    loopar.throw(\\\"Admin access required\\\", 403);\\n  }\\n  \\n  // Proceed with action\\n  return { secret: \\\"data\\\" };\\n}\\n```\"}},{\"element\":\"markdown\",\"data\":{\"label\":\"REST API\",\"key\":\"md_api_rest\",\"id\":\"api-rest\",\"name\":\"md_api_rest\",\"value\":\"# REST API\\n\\nLoopar automatically generates REST endpoints for all entities.\\n\\n---\\n\\n## Auto-Generated Endpoints\\n\\n| Method | Endpoint | Description |\\n|--------|----------|-------------|\\n| `GET` | `/api/{Entity}` | List documents |\\n| `GET` | `/api/{Entity}/{name}` | Get single document |\\n| `POST` | `/api/{Entity}` | Create document |\\n| `PUT` | `/api/{Entity}/{name}` | Update document |\\n| `DELETE` | `/api/{Entity}/{name}` | Delete document |\\n\\n---\\n\\n## List Documents\\n\\n```bash\\nGET /api/Customer\\n```\\n\\n**Query Parameters:**\\n\\n| Param | Description | Example |\\n|-------|-------------|--------|\\n| `page` | Page number | `?page=2` |\\n| `limit` | Records per page | `?limit=50` |\\n| `search` | Search term | `?search=john` |\\n| `order_by` | Sort field | `?order_by=created_at` |\\n| `order` | Sort direction | `?order=desc` |\\n| `fields` | Fields to return | `?fields=name,email` |\\n| `{field}` | Filter by field | `?status=Active` |\\n\\n**Example:**\\n```bash\\nGET /api/Customer?status=Active&limit=20&order_by=customer_name&order=asc\\n```\\n\\n**Response:**\\n```json\\n{\\n  \\\"data\\\": [\\n    { \\\"name\\\": \\\"CUST-0001\\\", \\\"customer_name\\\": \\\"John\\\", \\\"email\\\": \\\"john@...\\\" },\\n    { \\\"name\\\": \\\"CUST-0002\\\", \\\"customer_name\\\": \\\"Jane\\\", \\\"email\\\": \\\"jane@...\\\" }\\n  ],\\n  \\\"total\\\": 150,\\n  \\\"page\\\": 1,\\n  \\\"limit\\\": 20,\\n  \\\"pages\\\": 8\\n}\\n```\\n\\n---\\n\\n## Get Single Document\\n\\n```bash\\nGET /api/Customer/CUST-0001\\n```\\n\\n**Response:**\\n```json\\n{\\n  \\\"name\\\": \\\"CUST-0001\\\",\\n  \\\"customer_name\\\": \\\"John Doe\\\",\\n  \\\"email\\\": \\\"john@example.com\\\",\\n  \\\"status\\\": \\\"Active\\\",\\n  \\\"created_at\\\": \\\"2024-01-15T10:30:00Z\\\"\\n}\\n```\\n\\n---\\n\\n## Create Document\\n\\n```bash\\nPOST /api/Customer\\nContent-Type: application/json\\n\\n{\\n  \\\"customer_name\\\": \\\"New Customer\\\",\\n  \\\"email\\\": \\\"new@example.com\\\",\\n  \\\"status\\\": \\\"Lead\\\"\\n}\\n```\\n\\n**Response:**\\n```json\\n{\\n  \\\"success\\\": true,\\n  \\\"name\\\": \\\"CUST-0003\\\",\\n  \\\"message\\\": \\\"Document created\\\"\\n}\\n```\\n\\n---\\n\\n## Update Document\\n\\n```bash\\nPUT /api/Customer/CUST-0001\\nContent-Type: application/json\\n\\n{\\n  \\\"status\\\": \\\"VIP\\\",\\n  \\\"credit_limit\\\": 50000\\n}\\n```\\n\\n**Response:**\\n```json\\n{\\n  \\\"success\\\": true,\\n  \\\"name\\\": \\\"CUST-0001\\\",\\n  \\\"message\\\": \\\"Document updated\\\"\\n}\\n```\\n\\n---\\n\\n## Delete Document\\n\\n```bash\\nDELETE /api/Customer/CUST-0001\\n```\\n\\n**Response:**\\n```json\\n{\\n  \\\"success\\\": true,\\n  \\\"message\\\": \\\"Document deleted\\\"\\n}\\n```\\n\\n---\\n\\n## Custom Actions\\n\\nCall controller actions:\\n\\n```bash\\n# GET action\\nGET /api/Customer/stats\\n\\n# POST action with data\\nPOST /api/Customer/upgrade-to-vip\\nContent-Type: application/json\\n\\n{\\n  \\\"name\\\": \\\"CUST-0001\\\"\\n}\\n```\\n\\n---\\n\\n## Error Responses\\n\\n```json\\n{\\n  \\\"error\\\": true,\\n  \\\"message\\\": \\\"Customer not found\\\",\\n  \\\"status\\\": 404\\n}\\n```\\n\\n| Status | Meaning |\\n|--------|--------|\\n| `400` | Bad request / Validation error |\\n| `401` | Authentication required |\\n| `403` | Permission denied |\\n| `404` | Document not found |\\n| `500` | Server error |\\n\\n---\\n\\n## Authentication\\n\\nInclude session token in requests:\\n\\n```bash\\nGET /api/Customer\\nAuthorization: Bearer {token}\\n```\\n\\nOr use cookie-based session after login.\"}},{\"element\":\"markdown\",\"data\":{\"label\":\"Client Hooks\",\"key\":\"md_api_client\",\"id\":\"api-client\",\"name\":\"md_api_client\",\"value\":\"# Client-Side API\\n\\nReact hooks and utilities for client-side code (.jsx files).\\n\\n---\\n\\n## useDocument Hook\\n\\nAccess and manipulate the current document in a form.\\n\\n```jsx\\nimport { useDocument } from \\\"@loopar/components\\\";\\n\\nexport default function CustomerForm(props) {\\n  const { \\n    document,     // Current document data\\n    setValue,     // Set field value\\n    getValue,     // Get field value\\n    save,         // Save document\\n    loading,      // Loading state\\n    errors        // Validation errors\\n  } = useDocument();\\n\\n  return (\\n    <div>\\n      <h1>{document.customer_name}</h1>\\n      <p>Status: {document.status}</p>\\n      \\n      <button \\n        onClick={() => setValue(\\\"status\\\", \\\"VIP\\\")}\\n        disabled={loading}\\n      >\\n        Upgrade to VIP\\n      </button>\\n      \\n      <button onClick={save} disabled={loading}>\\n        {loading ? \\\"Saving...\\\" : \\\"Save\\\"}\\n      </button>\\n    </div>\\n  );\\n}\\n```\\n\\n---\\n\\n### setValue(field, value)\\n\\nUpdate a field value.\\n\\n```jsx\\nsetValue(\\\"status\\\", \\\"Active\\\");\\nsetValue(\\\"amount\\\", 1500.50);\\nsetValue(\\\"items\\\", [...document.items, newItem]);\\n```\\n\\n---\\n\\n### getValue(field)\\n\\nGet current field value.\\n\\n```jsx\\nconst status = getValue(\\\"status\\\");\\nconst total = getValue(\\\"total\\\");\\n```\\n\\n---\\n\\n### save()\\n\\nSave the document.\\n\\n```jsx\\nconst handleSave = async () => {\\n  try {\\n    await save();\\n    toast.success(\\\"Saved successfully!\\\");\\n  } catch (error) {\\n    toast.error(error.message);\\n  }\\n};\\n```\\n\\n---\\n\\n## useLoopar Hook\\n\\nAccess Loopar utilities.\\n\\n```jsx\\nimport { useLoopar } from \\\"@loopar/components\\\";\\n\\nexport default function MyComponent() {\\n  const loopar = useLoopar();\\n  \\n  const handleAction = async () => {\\n    const result = await loopar.call({\\n      entity: \\\"Customer\\\",\\n      action: \\\"stats\\\"\\n    });\\n    \\n    console.log(result);\\n  };\\n  \\n  return <button onClick={handleAction}>Get Stats</button>;\\n}\\n```\\n\\n---\\n\\n### loopar.call(options)\\n\\nCall a server action.\\n\\n```jsx\\n// GET action\\nconst stats = await loopar.call({\\n  entity: \\\"Customer\\\",\\n  action: \\\"stats\\\"\\n});\\n\\n// POST action with data\\nconst result = await loopar.call({\\n  entity: \\\"Customer\\\",\\n  action: \\\"upgrade-to-vip\\\",\\n  method: \\\"POST\\\",\\n  data: { name: \\\"CUST-0001\\\" }\\n});\\n```\\n\\n---\\n\\n### loopar.navigate(path)\\n\\nNavigate to a different page.\\n\\n```jsx\\nloopar.navigate(\\\"/desk/Customer/list\\\");\\nloopar.navigate(\\\"/desk/Customer/edit/CUST-0001\\\");\\n```\\n\\n---\\n\\n## BaseForm Component\\n\\nWrapper for entity forms.\\n\\n```jsx\\nimport { BaseForm } from \\\"@loopar/components\\\";\\n\\nexport default function CustomerForm(props) {\\n  return (\\n    <BaseForm {...props}>\\n      {/* Custom content renders above default fields */}\\n      <div className=\\\"custom-header\\\">\\n        {/* Custom UI */}\\n      </div>\\n      \\n      {/* Default fields render automatically */}\\n    </BaseForm>\\n  );\\n}\\n```\\n\\n---\\n\\n## Utility Components\\n\\n```jsx\\nimport { \\n  Button,\\n  Input,\\n  Select,\\n  Badge,\\n  Alert,\\n  Card,\\n  Table\\n} from \\\"@loopar/components\\\";\\n\\n// Or from shadcn/ui\\nimport { Button } from \\\"@/components/ui/button\\\";\\nimport { Badge } from \\\"@/components/ui/badge\\\";\\n```\\n\\n---\\n\\n## Example: Custom Form UI\\n\\n```jsx\\nimport { BaseForm, useDocument } from \\\"@loopar/components\\\";\\nimport { Button } from \\\"@/components/ui/button\\\";\\nimport { Badge } from \\\"@/components/ui/badge\\\";\\nimport { CheckCircle, AlertTriangle } from \\\"lucide-react\\\";\\n\\nexport default function TaskForm(props) {\\n  const { document, setValue, save, loading } = useDocument();\\n\\n  const markComplete = async () => {\\n    setValue(\\\"status\\\", \\\"Completed\\\");\\n    setValue(\\\"completed_at\\\", new Date().toISOString());\\n    await save();\\n  };\\n\\n  const isOverdue = document.due_date && \\n    new Date(document.due_date) < new Date() && \\n    document.status !== \\\"Completed\\\";\\n\\n  return (\\n    <BaseForm {...props}>\\n      {/* Status Header */}\\n      <div className=\\\"flex items-center justify-between p-4 bg-muted rounded-lg mb-6\\\">\\n        <div className=\\\"flex items-center gap-2\\\">\\n          <h2 className=\\\"font-semibold\\\">{document.title || \\\"New Task\\\"}</h2>\\n          <Badge variant={document.status === \\\"Completed\\\" ? \\\"success\\\" : \\\"default\\\"}>\\n            {document.status}\\n          </Badge>\\n        </div>\\n        \\n        {document.status !== \\\"Completed\\\" && (\\n          <Button onClick={markComplete} disabled={loading}>\\n            <CheckCircle className=\\\"w-4 h-4 mr-2\\\" />\\n            Mark Complete\\n          </Button>\\n        )}\\n      </div>\\n\\n      {/* Overdue Warning */}\\n      {isOverdue && (\\n        <div className=\\\"p-3 mb-4 bg-destructive/10 text-destructive rounded-lg flex items-center gap-2\\\">\\n          <AlertTriangle className=\\\"w-4 h-4\\\" />\\n          This task is overdue!\\n        </div>\\n      )}\\n    </BaseForm>\\n  );\\n}\\n```\"}}],\"imageProps\":{},\"style\":{}}]",
  "__ENTITY__": "Page Builder"
}